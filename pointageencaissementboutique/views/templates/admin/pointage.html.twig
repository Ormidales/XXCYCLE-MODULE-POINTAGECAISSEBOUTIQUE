{% extends '@PrestaShop/Admin/layout.html.twig' %}

{% block content %}

<script src="https://cdn.tailwindcss.com"></script>

<style>
table,
td {
    border: 1px solid #333;
	padding: 5px;
}

thead,
tfoot {
    background-color: #333;
    color: #fff;
	padding: 5px;
}
textarea {
  resize: vertical;
}
</style>

	<div class="w-full bg-gray-50 p-3 rounded-lg overflow-auto">
		<div class="w-full px-3 py-2 bg-gray-600 flex items-center justify-between items-center mb-4 rounded-lg">
			<p class="text-white text-[18px] font-bold">Liste des encaissements</p>
			<form class="ml-3 flex inline">
				<input type="date" class="w-[40vh] h-[4vh] border border-black text-black px-2">
				<select class="ml-2 w-[18vh] h-[4vh] px-2">
					<option>CB + PNF</option>
					<option>CHEQUE</option>
					<option>ESPECE</option>
					<option>CREDIT CLIENT</option>
					<option>VIREMENT</option>
					<option>PAYPAL</option>
					<option>1EURO</option>
					<option>LCR</option>
				</select>
				<select class="ml-2 w-[18vh] h-[4vh] px-2">
					<option>Boutique</option>
					<option>Internet</option>
				</select>
				<input type="submit" value="Charger" class="ml-2 bg-blue-500 px-4 py-1 rounded-lg text-white">
			</form>
		</div>
		<div class="w-full flex gap-3 overflow-auto relative">
			<div class="w-3/4">
				<table class="w-full rounded-lg">
					<thead>
						<tr>
							<th class="p-1">Mode</th>
							<th class="p-1">Type</th>
							<th class="p-1 flex items-center justify-between">
								<p>Montant</p>
								<div>
									<p class="hidden">0</p>
									<input id="select-all" type="checkbox">
								</div>
							</th>
							<th class="p-1">Montant Encaissé</th>
							<th class="p-1">Facture</th>
							<th class="p-1">Date</th>
							<th class="p-1">Client</th>
							<th class="p-1">Vendeur</th>
						</tr>
					</thead>
					<tbody>
					{% for item in data %}	
						{% set orderViewUrl = getAdminLink('AdminOrders', true, {'id_order': item.id_order, 'vieworder': 1}) %}
						<tr>
							<td>
								<select class="h-[3vh] px-2 w-full">
									<option>CB</option>
									<option>ESPECE</option>
									<option>CHEQUE</option>
									<option>VIREMENT</option>
									<option>XXCB</option>
									<option>CREDIT CLIENT</option>
								</select>
							</td>
							<td> {{item.type_order}} </td>
							<td>
								<div class="w-full flex inline items-center justify-between">
									<p> {{item.montant}} </p>
									<input type="checkbox">
								</div>
							</td>
							<td>
								<div class="w-full">
									{% if item.montant in item.montant_payment %}
									<input type="text" value="{{item.montant_payment}}" class="w-full border-2 border-green-700 text-green-700 px-1 bg-green-500/5">
									{% else %}
									<input type="text" value="{{item.montant_payment}}" class="w-full border-2 border-red-700 text-red-700 px-1 bg-red-500/5">
									{% endif %}
								</div>
							</td>
							<td> <a href={{ orderViewUrl }}>{{item.id_order}}</a> </td>
							<td> {{item.date_facturation}} </td>
							<td> {{item.nom_customer}} </td>
							<td> {{item.nom_employee}} </td>
						</tr>
						{# <tr>
							<td>
								<select class="w-[12vh] h-[3vh]">
									<option>CB</option>
									<option>ESPECE</option>
									<option>CHEQUE</option>
									<option>VIREMENT</option>
									<option>XXCB</option>
									<option>CREDIT CLIENT</option>
								</select>
							</td>
							<td> FACTURE </td>
							<td>
								<div class="w-full flex inline items-center justify-between">
									<p> {{item.id_employee}} </p>
									<input type="checkbox">
								</div>
							</td>
							<td>
								<div class="w-full">
									<input type="text" value="" class="border border-green-600 text-green-600">
								</div>
							</td>
							<td> {{item.lastname}} </td>
							<td>  </td>
							<td>  </td>
						</tr> #}
					{% endfor %}
					</tbody>
				</table>
			</div>
			<div id="sidebar" class="w-1/4 sticky top-0">
				<div class="w-full border-2 border-black rounded-lg bg-gray-100">
					<div class="w-full flex items-center justify-between border-b-2 border-black px-4 py-2">
						<p class="text-black text-[14px]">Nombre de Tickets</p>
						<p class="text-black text-[14px] font-bold">4</p>
					</div>
					<div class="w-full flex items-center justify-between border-b-2 border-black px-4 py-2">
						<p class="text-black text-[14px]">Total Théorique</p>
						<div class="flex items-center">
							{% set total = 0 %}
							{% for item in data %}
								{% set total = total + item.montant %}
							{% endfor %}
							<p id="total-theorique" class="text-black text-[14px] font-bold">{{ total }}</p>
							<p class="text-black text-[14px] font-bold ml-1">€</p>
						</div>
					</div>
					<div class="w-full flex items-center justify-between border-b-2 border-black px-4 py-2">
						<p class="text-black text-[14px]">Total Coché</p>
						<div class="flex items-center">
							<p id="total-coche" class="text-black text-[14px] font-bold">0.00</p>
							<p class="text-black text-[14px] font-bold ml-1">€</p>
						</div>
					</div>
					<div class="w-full flex items-center justify-between border-b-2 border-black px-4 py-2">
						<p class="text-black text-[14px]">Différence</p>
						<div class="flex items-center">
							<p class="text-black text-[14px] font-bold">0.00</p>
							<p class="text-black text-[14px] font-bold ml-1">€</p>
						</div>
					</div>
					<div class="w-full px-4 py-2 pb-4">
						<p class="text-black text-[14px]">Commentaire</p>
						<textarea class="mt-2 w-full min-h-[20vh] border border-black"></textarea>
						<input type="submit" value="Valider" class="mt-2 bg-blue-500 px-3 py-1 rounded-lg text-white">
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
	
</script>

<script>
  // Écoutez les changements dans les cases à cocher
  document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
    checkbox.addEventListener('change', updateTotal);
  });

  function updateTotal() {
    // Sélectionnez toutes les cases à cocher cochées
    const checkedCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');

    // Ajouter les valeurs correspondantes des cases à cocher cochées
    let total = 0;
    checkedCheckboxes.forEach(checkbox => {
      // Obtenez la valeur de l'élément parent de la case à cocher.
      const amount = checkbox.parentElement.querySelector('p').innerText;
      total += parseFloat(amount);
    });

    // Afficher le total
    document.querySelector('#total-coche').innerText = total;
  }

  // Écoutez les clics sur la case à cocher "select-all".
  document.querySelector('#select-all').addEventListener('click', selectAll);

  function selectAll() {
    // Sélectionnez toutes les cases à cocher.
    const checkboxes = document.querySelectorAll('input[type="checkbox"]');

    // Cocher ou décocher toutes les cases à cocher en fonction de l'état de la case à cocher "Sélectionner tout".
    const isChecked = document.querySelector('#select-all').checked;
    checkboxes.forEach(checkbox => {
      checkbox.checked = isChecked;
    });
  }
</script>

{% endblock %}